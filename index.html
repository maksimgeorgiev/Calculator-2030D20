<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="–†–µ—Å—Ç–æ –ö–∞–ª—å–∫—É–ª–∞—Ç–æ—Ä" />
  <title>–†–µ—Å—Ç–æ ‚Äî –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä</title>

  <!-- Fonts: –∞—Ä—Ç–∏—Å—Ç–∏—á–µ–Ω/–∑–∞–æ–±–ª–µ–Ω –∑–∞ –∑–∞–≥–ª–∞–≤–∏—è –∏ –∏–∫–æ–Ω–∏, —Å—Ç–µ–≥–Ω–∞—Ç –¥–µ–ª–æ–≤–∏ –∑–∞ –¥–∞–Ω–Ω–∏ -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Tailwind CDN (single-file simplicity). We use the play CDN to enable custom theme. -->
  <script>
    // Tailwind inline config before loading so classes are interpreted on first paint
    window.tailwind = {
      config: {
        theme: {
          extend: {
            colors: {
              navy1: '#0f172a',
              navy2: '#020617',
              gold: {
                400: '#f6c84c',
                500: '#eab308'
              },
              glass: 'rgba(255,255,255,0.06)'
            },
            fontFamily: {
              display: ['Rubik', 'system-ui', 'sans-serif'],
              body: ['Inter', 'system-ui', 'sans-serif']
            },
            boxShadow: {
              'deep-lg': '0 20px 40px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02)'
            },
            borderRadius: {
              'xl-xl': '24px'
            }
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Glass and layout fine-tuning */
    :root { --rate: 1.95583; }
    html,body { height: 100%; background: linear-gradient(180deg,#0f172a 0%, #020617 100%); font-family: Inter, system-ui, sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .app-window {
      backdrop-filter: blur(8px) saturate(110%);
      -webkit-backdrop-filter: blur(8px) saturate(110%);
    }
    /* Rounded app card specifics */
    .card {
      border-radius: 20px;
      box-shadow: 0 18px 40px rgba(2,6,23,0.72), inset 0 1px 0 rgba(255,255,255,0.02);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));
      border: 1px solid rgba(255,255,255,0.04);
    }

    /* Rest box animation */
    @keyframes appearUp {
      from { opacity:0; transform: translateY(8px) scale(.995); }
      to { opacity:1; transform: translateY(0) scale(1); }
    }

    /* Floating pattern animation */
    @keyframes floatXY {
      0% { transform: translate3d(0,0,0) rotate(0) scale(1); }
      50% { transform: translate3d(6px,-6px,0) rotate(3deg) scale(1.02); }
      100% { transform: translate3d(0,0,0) rotate(0) scale(1); }
    }

    /* make small inputs thumb-friendly */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

    /* Segmented control */
    .seg-btn { transition: all .18s ease; }
    .seg-btn.active { background: linear-gradient(90deg,#0ea5a9, #fbbf24); color: #041025; box-shadow: 0 6px 18px rgba(234,179,8,.12); }

    /* Low opacity icons background */
    .pattern-cell { opacity: 0.08; color: #9ca3b3; font-size: 18px; display:flex; align-items:center; justify-content:center; }
    .pattern-cell .symbol { transform-origin: center; animation: floatXY 6s ease-in-out infinite; }
    .pattern-cell:nth-child(odd) .symbol { animation-duration: 7s; animation-direction: alternate; }
    .pattern-grid { pointer-events: none; }

    /* Error box */
    .error-box { background: linear-gradient(90deg,#7f1d1d, #991b1b); color: #fff; border-radius: 12px; padding: 10px 12px; box-shadow: 0 8px 24px rgba(153,27,27,0.24); }

    /* Mobile optimizations for one-handed use: inputs lower on screen */
    @media (max-width:640px) {
      .card { margin: 18px; }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <!-- Decorative pattern (chessboard of symbols) -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="w-full h-full grid grid-cols-6 gap-6 p-8 pattern-grid">
      <!-- We'll generate cells dynamically from JS for strict alternation -->
    </div>
  </div>

  <!-- App container -->
  <main class="relative w-full max-w-xl mx-auto">
    <div class="card app-window p-6 md:p-8">
      <header class="flex items-center gap-4 mb-4">
        <!-- Tile logo -->
        <div id="tile" class="flex-none w-14 h-14 rounded-xl-xl flex items-center justify-center"
             style="background: linear-gradient(180deg, #f6c84c, #0ea5e9); border: 1px solid rgba(0,0,0,0.08);">
          <!-- Use a simple SVG inline for the tile -->
          <svg width="44" height="44" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden>
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#0ea5e9"/>
                <stop offset="1" stop-color="#eab308"/>
              </linearGradient>
            </defs>
            <rect x="0" y="0" width="64" height="64" rx="12" fill="url(#g1)"/>
            <g transform="translate(8,8)" fill="#041025" font-family="Rubik, sans-serif" font-weight="700" font-size="26">
              <text x="2" y="26">‚Ç¨</text>
              <text x="28" y="26" font-size="20">–ª–≤</text>
            </g>
          </svg>
        </div>

        <div class="flex-1">
          <h1 class="font-display text-white text-lg leading-tight" style="font-family:Rubik, sans-serif;">–†–µ—Å—Ç–æ</h1>
          <p class="text-gray-300 text-sm mt-0.5" style="font-family:Inter, sans-serif;">–õ–µ—Å–Ω–æ –∏ –±—ä—Ä–∑–æ ‚Äî BGN ‚áÑ EUR</p>
        </div>
      </header>

      <!-- Form -->
      <section class="space-y-4" aria-labelledby="calc-title">
        <label id="calc-title" class="sr-only">–ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä –Ω–∞ —Ä–µ—Å—Ç–æ</label>

        <!-- –°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ -->
        <div class="grid grid-cols-12 gap-3 items-center">
          <div class="col-span-8">
            <label class="text-gray-300 text-sm mb-1 block">–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ</label>
            <input id="amount" inputmode="decimal" type="number" step="0.01" min="0"
                   class="w-full py-3 px-3 rounded-lg bg-[#e5e7eb] text-gray-900 font-medium focus:outline-none"
                   placeholder="0.00" aria-label="–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ" />
          </div>

          <div class="col-span-4">
            <label class="text-gray-300 text-sm mb-1 block">–í–∞–ª—É—Ç–∞</label>
            <select id="amount-currency" class="w-full py-3 px-2 rounded-lg bg-[#0b1220] text-white">
              <option value="BGN">BGN (–ª–≤)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
            </select>
          </div>
        </div>

        <!-- –ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–≤ –∏ –ø–ª–∞—Ç–µ–Ω–æ –≤ ‚Ç¨ -->
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-6">
            <label class="text-gray-300 text-sm mb-1 block">–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–≤</label>
            <input id="paid-bgn" inputmode="decimal" type="number" step="0.01" min="0"
                   class="w-full py-3 px-3 rounded-lg bg-[#0f172a] text-white border border-transparent focus:outline-none"
                   placeholder="0.00" />
          </div>

          <div class="col-span-6">
            <label class="text-gray-300 text-sm mb-1 block">–ü–ª–∞—Ç–µ–Ω–æ –≤ ‚Ç¨</label>
            <input id="paid-eur" inputmode="decimal" type="number" step="0.01" min="0"
                   class="w-full py-3 px-3 rounded-lg bg-[#0f172a] text-white border border-transparent focus:outline-none"
                   placeholder="0.00" />
          </div>
        </div>

        <!-- Error box -->
        <div id="error" class="hidden">
          <div class="error-box text-sm" role="alert"></div>
        </div>

        <!-- –†–µ–∑—É–ª—Ç–∞—Ç–∏ -->
        <div id="result-area" class="mt-2">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-300 text-sm">–†–µ—Å—Ç–æ</p>
              <div id="resto-box" class="mt-2 p-4 rounded-lg bg-gradient-to-r from-transparent to-transparent" style="min-height:56px; display:flex; align-items:center;">
                <div class="flex items-center gap-4">
                  <div id="resto-amount" class="text-white text-2xl font-semibold animate__animated" style="animation-duration:.28s; animation-fill-mode:both;"></div>
                  <div id="resto-secondary" class="text-gray-300 text-sm"></div>
                </div>
              </div>
            </div>

            <div class="ml-4">
              <p class="text-gray-300 text-sm mb-2">–í–∏–∂ –∫–∞—Ç–æ</p>
              <div class="flex rounded-lg bg-[#071023] p-1">
                <button id="seg-bgn" class="seg-btn py-1 px-3 text-sm rounded-md text-white active">BGN</button>
                <button id="seg-eur" class="seg-btn py-1 px-3 text-sm rounded-md text-white ml-1">EUR</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Helpful info -->
        <div class="mt-4 text-xs text-gray-400">
          <p>–ö—É—Ä—Å—ä—Ç –µ —Ñ–∏–∫—Å–∏—Ä–∞–Ω: <strong>1 EUR = 1.95583 BGN</strong></p>
        </div>
      </section>

      <footer class="mt-6 pt-4 border-t border-white/6 flex items-center justify-between">
        <div class="text-sm text-gray-300">–ö—É—Ä—Å: 1 EUR = 1.95583 BGN</div>
        <div class="text-sm text-gray-400">–ú–∞–∫—Å–∏–º –ì–µ–æ—Ä–≥–∏–µ–≤ ¬©</div>
      </footer>
    </div>
  </main>

  <!-- No install button per request; we will still register manifest & service worker -->
  <script>
    // Bulgarian locale utilities
    const RATE = 1.95583;
    const nfBGN = new Intl.NumberFormat('bg-BG', { style:'currency', currency:'BGN', maximumFractionDigits:2 });
    const nfEUR = new Intl.NumberFormat('bg-BG', { style:'currency', currency:'EUR', maximumFractionDigits:2 });

    // Elements
    const amountEl = document.getElementById('amount');
    const amountCurEl = document.getElementById('amount-currency');
    const paidBGN = document.getElementById('paid-bgn');
    const paidEUR = document.getElementById('paid-eur');
    const errorBox = document.getElementById('error');
    const errorMsg = errorBox.querySelector('.error-box');
    const restoAmount = document.getElementById('resto-amount');
    const restoSecondary = document.getElementById('resto-secondary');
    const segBGN = document.getElementById('seg-bgn');
    const segEUR = document.getElementById('seg-eur');
    const restoBox = document.getElementById('resto-box');

    let displayCurrency = 'BGN';

    // Input listeners (real time)
    [amountEl, amountCurEl, paidBGN, paidEUR].forEach(el => {
      el.addEventListener('input', compute);
      el.addEventListener('change', compute);
    });

    segBGN.addEventListener('click', () => { setDisplay('BGN'); });
    segEUR.addEventListener('click', () => { setDisplay('EUR'); });

    function setDisplay(cur) {
      displayCurrency = cur;
      segBGN.classList.toggle('active', cur==='BGN');
      segEUR.classList.toggle('active', cur==='EUR');
      compute();
    }

    // Format helpers
    function toNumber(v) {
      if (v === undefined || v === null || v === '') return 0;
      const n = Number(String(v).replace(',', '.'));
      return isFinite(n) ? n : 0;
    }

    function compute() {
      // Read values
      const amountVal = toNumber(amountEl.value);
      const amountCur = amountCurEl.value || 'BGN';
      const amountInBGN = amountCur === 'EUR' ? (amountVal * RATE) : amountVal;

      const paidInBGNVal = toNumber(paidBGN.value);
      const paidInEURVal = toNumber(paidEUR.value);

      const paidTotalBGN = paidInBGNVal + paidInEURVal * RATE;
      const diff = +(paidTotalBGN - amountInBGN).toFixed(6); // positive: change due

      // Reset
      errorBox.classList.add('hidden');
      errorMsg.textContent = '';

      if (diff < -0.0005) { // insufficient
        const need = Math.abs(diff);
        const needBGN = nfBGN.format(need);
        const needEUR = nfEUR.format(need / RATE);
        errorBox.classList.remove('hidden');
        errorMsg.innerHTML = `–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–∞ —Å—É–º–∞ ‚Äî –æ—Å—Ç–∞–≤–∞—Ç ${needBGN} (${needEUR})`;
        // Show zero resto
        showResto(0);
      } else {
        const restoBGN = Math.max(0, diff);
        showResto(restoBGN);
      }
    }

    function showResto(restoBGN) {
      // Animate appear
      restoBox.style.animation = 'appearUp .28s ease forwards';
      setTimeout(()=> restoBox.style.animation = '', 300);

      if (displayCurrency === 'BGN') {
        restoAmount.textContent = nfBGN.format(restoBGN);
        const equiv = nfEUR.format(restoBGN / RATE);
        restoSecondary.textContent = `‚âà ${equiv}`;
      } else {
        const restoEUR = restoBGN / RATE;
        restoAmount.textContent = nfEUR.format(restoEUR);
        const equiv = nfBGN.format(restoEUR * RATE);
        restoSecondary.textContent = `‚âà ${equiv}`;
      }
    }

    // Initial compute
    compute();

    // Build decorative pattern grid with strict alternation of symbols
    (function buildPattern() {
      const symbols = ['‚Ç¨', '–ª–≤', '‚Éò', '‚Éù', '‚Üî', '‚åñ']; // mix of currency and exchange icons (some unicode)
      // For clarity: coins/ bank/ calculator/ arrows: we'll use emoji-ish / unicode characters that fit
      const symbolsAlt = ['üí∂','üí∞','üßæ','‚Ü©','‚ûó','üîÅ'];
      const grid = document.querySelector('.pattern-grid');
      const total = 36; // 6x6
      for (let i=0;i<total;i++){
        const cell = document.createElement('div');
        cell.className = 'pattern-cell rounded-lg';
        // Strict alternation: pick from two arrays depending on row/col parity
        const r = Math.floor(i/6), c = i%6;
        const pick = ((r + c) % 2 === 0) ? symbols : symbolsAlt;
        const char = pick[(i) % pick.length];
        const span = document.createElement('div');
        span.className = 'symbol';
        span.style.fontSize = (12 + (i % 3) * 3) + 'px';
        span.textContent = char;
        // stagger animation
        span.style.animationDelay = `${(i % 6) * 0.12}s`;
        cell.appendChild(span);
        grid.appendChild(cell);
      }
    })();

    // Generate SVG icon (split circle, blue & gold, ‚Ç¨ and –ª–≤ intertwined)
    function generateSVGIcon(size = 512) {
      const svg = `
      <svg xmlns='http://www.w3.org/2000/svg' width='${size}' height='${size}' viewBox='0 0 512 512' role='img' aria-label='icon'>
        <defs>
          <linearGradient id='g' x1='0' x2='1'>
            <stop offset='0' stop-color='#0ea5e9'/>
            <stop offset='1' stop-color='#eab308'/>
          </linearGradient>
        </defs>
        <rect width='100%' height='100%' rx='64' fill='url(#g)' />
        <g transform='translate(64,64)'>
          <circle cx='192' cy='192' r='160' fill='none' stroke='rgba(255,255,255,0.06)' stroke-width='12'/>
          <g transform='translate(192,192)'>
            <!-- split circle -->
            <path d='M0,-160 A160,160 0 0,1 0,160 L0,0 Z' fill='#0ea5e9'/>
            <path d='M0,160 A160,160 0 0,1 0,-160 L0,0 Z' fill='#eab308'/>
            <!-- vertical divider -->
            <rect x='-6' y='-160' width='12' height='320' fill='rgba(0,0,0,0.08)'/>
            <!-- currency symbols -->
            <text x='-70' y='20' font-family='Rubik, sans-serif' font-weight='700' font-size='120' fill='rgba(0,0,0,0.85)'>‚Ç¨</text>
            <text x='20' y='36' font-family='Rubik, sans-serif' font-weight='700' font-size='64' fill='rgba(0,0,0,0.85)'>–ª–≤</text>
          </g>
        </g>
      </svg>
      `;
      return svg.trim();
    }

    // Create manifest dynamically and add link to document
    (function createManifest() {
      const svg512 = generateSVGIcon(512);
      const svg192 = generateSVGIcon(192);
      function svgToDataUrl(svg) {
        const enc = encodeURIComponent(svg).replace(/'/g,"%27").replace(/"/g,"%22");
        return `data:image/svg+xml;charset=utf-8,${enc}`;
      }
      const manifest = {
        name: "–†–µ—Å—Ç–æ ‚Äî –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä",
        short_name: "–†–µ—Å—Ç–æ",
        start_url: ".",
        display: "standalone",
        background_color: "#0f172a",
        theme_color: "#0f172a",
        icons: [
          { src: svgToDataUrl(svg192), sizes:"192x192", type:"image/svg+xml" },
          { src: svgToDataUrl(svg512), sizes:"512x512", type:"image/svg+xml" }
        ]
      };
      const manifestStr = JSON.stringify(manifest);
      const blob = new Blob([manifestStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = url;
      document.head.appendChild(link);

      // Apple touch icon (iOS)
      const appleLink = document.createElement('link');
      appleLink.rel = 'apple-touch-icon';
      appleLink.href = manifest.icons[0].src;
      document.head.appendChild(appleLink);
    })();

    // Register a tiny service worker via blob so that the single-file app can be cached
    (function registerSW() {
      if ('serviceWorker' in navigator) {
        const swCode = `
          const CACHE = 'resto-cache-v1';
          const offlineFiles = ['${location.pathname}'];
          self.addEventListener('install', event => {
            event.waitUntil(
              caches.open(CACHE).then(cache => cache.addAll(offlineFiles))
            );
            self.skipWaiting();
          });
          self.addEventListener('activate', event => {
            event.waitUntil(self.clients.claim());
          });
          self.addEventListener('fetch', event => {
            const req = event.request;
            // Only handle navigation and same-origin resources
            if (req.method !== 'GET') return;
            event.respondWith(
              caches.match(req).then(cached => {
                const networkFetch = fetch(req).then(resp => {
                  // update cache for same-origin
                  if (req.url.startsWith(self.location.origin)) {
                    caches.open(CACHE).then(c => c.put(req, resp.clone()));
                  }
                  return resp;
                }).catch(() => cached);
                return cached || networkFetch;
              })
            );
          });
        `;
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swUrl).catch(()=>{/*sw reg failed silently*/});
      }
    })();

    // Accessibility: ensure large hit targets for one-handed use (no extra code needed; design ensures it)
    // End of script
  </script>
</body>
</html>
